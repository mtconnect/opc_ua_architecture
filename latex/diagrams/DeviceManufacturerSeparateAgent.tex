%Block Styles

\tikzstyle{blockblue} = [rectangle, draw, fill=blue!20,
    text width=5em, text centered, rounded corners, minimum height=6em]
    
\tikzstyle{blockred} = [rectangle, draw, fill=red!20,
    text width=5em, text centered, rounded corners, minimum height=4em]
    
\tikzstyle{blockyellow} = [rectangle, draw, fill=yellow!20,
    text width=10em, text centered, rounded corners, minimum height=5em]
    
\tikzstyle{blockviolet} = [rectangle, draw, fill=violet!20,
    text width=6em, text centered, rounded corners, minimum height=4em]
    
\tikzstyle{blockpurple} = [rectangle, draw, fill=purple!20,
    text width=6em, text centered, rounded corners, minimum height=4em]
    
\tikzstyle{blockwhite} = [rectangle, draw, fill=white!20,
    text width=5em, text centered, rounded corners, minimum height=6em]
    
\tikzstyle{blockwhitelarge} = [rectangle, draw, dashed, fill=white!20,
    text width=13em, text centered, rounded corners, minimum height=8em]
    
\tikzstyle{line} = [draw, very thick, color=black!50, -{Latex[scale=1.5]}]

\begin{figure}[ht]
\centering\scalebox{0.8}{\begin{tikzpicture}[scale = 3, node distance = 2cm, auto]
    % Place nodes
    \node [blockyellow] (mtcopcgateway) {MTConnect To OPC-UA Gateway};
    \node [blockviolet, left of=mtcopcgateway, node distance = 5cm] (opcuaclient) {PLCOpen OPC-UA Client};
    \node [blockviolet, below of=opcuaclient] (genericopcuaclient) {Generic OPC-UA Client};
    \node [blockviolet, below of=genericopcuaclient] (mtcopcclient) {MTConnect OPC-UA Client};
    \node [blockpurple, below of=mtcopcclient] (mtcapplication) {MTConnect Application};
    \node [blockwhitelarge, right of=mtcapplication, node distance = 8cm] (parentnode) {};
    \node [blockwhite, right of=mtcapplication, node distance = 6.7cm] (internalapi) {Internal Device APIs};
    \node [blockred, below of=mtcopcgateway, node distance =3 cm] (mtcagent) {MTConnect Agent};
    \node [blockblue, right of=internalapi, node distance = 2.4cm] (devicehardware) {Device Hardware};
    
    % Draw edges
    \coordinate [left of = mtcopcgateway, node distance = 2.75cm ] (a);
    \coordinate [left of = mtcagent, node distance = 2cm ] (b);
    
    \path [line] (mtcopcgateway) -- (opcuaclient);
    \path [line]  (opcuaclient) -- (mtcopcgateway);
    \path [line] (mtcopcgateway) -- (a) |- (genericopcuaclient);
    \path [line] (mtcopcgateway) -- (a) |- (mtcopcclient);
    \path [line] (genericopcuaclient) -| (a) -- (mtcopcgateway);
    \path [line] (mtcopcclient) -| (a) -- (mtcopcgateway);
    \path [line] (mtcagent) -- (mtcopcgateway);
    \path [line] (mtcopcgateway) -- (mtcagent);
    \path [line] (mtcapplication) -| (b) -- (mtcagent);
    \path [line] (mtcagent) -- (b) |- (mtcapplication);
    \path [line] (parentnode) |- (mtcagent);
    \end{tikzpicture}}
\caption{Device Manufacturer with Separate MTConnect Agent}
 \label{fig:devicemanufacturerseparateagent}
\end{figure}